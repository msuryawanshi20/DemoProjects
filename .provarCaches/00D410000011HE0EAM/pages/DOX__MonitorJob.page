<!--
 Monitor the status of the document job    
-->
<apex:page controller="DOX.MonitorJobExt">
	<apex:variable var="f" value="{!$ObjectType.DOX__Document_Job__c.fields}" />
    <c:KendoResources ></c:KendoResources>
    <apex:form id="formId">
        <apex:pageBlock id="docResult">
            <apex:pageBlockButtons location="top" id="formButton">
                <apex:commandButton action="{!cancel}" value="Go Back"/>
                <apex:commandButton action="{!sendEmail}" value="Send Email" rendered="{!job.DOX__Status__c=='Completed' && job.DOX__Operation__c != 'getFields'}" immediate="false" oncomplete="window.location.reload()"/>
            </apex:pageBlockButtons>
            <apex:pageBlockSection id="status" columns="2">
                <!-- <div id="status"></div>
                <div id="result"></div> -->
                <apex:outputField value="{!job.DOX__Application__c}"></apex:outputField>
                <apex:outputField value="{!job.DOX__Operation__c}"></apex:outputField>
                <apex:outputField value="{!job.DOX__Status__c}"></apex:outputField>
                <apex:pageBlockSection />
				<!-- <apex:outputField value="{!job.DOX__emailStatus__c}" rendered="{!job.Email_Document__c}"></apex:outputField> --> <!-- Blocked under RSTK-7182 -->
				<!-- <apex:outputField value="{!job.DOX__emailStatus__c}" rendered="{!job.DOX__Operation__c != 'getFields'}"></apex:outputField> --> <!-- Added under RSTK-7182 -->
				<apex:pageBlockSectionItem helptext="{!f.DOX__additional_Email_Ids__c.inlineHelpText}" rendered="{!job.DOX__Status__c=='Completed' && job.DOX__Operation__c != 'getFields'}">
                    <apex:outputLabel value="{!f.DOX__additional_Email_Ids__c.label}" />
                    <apex:inputTextarea id="additional_emails" value="{!emailIDs}" rows="3" cols="60"/>
                </apex:pageBlockSectionItem>
				<apex:outputField value="{!job.DOX__Additional_Rec_Linkage_Staus__c}" rendered="{!job.DOX__attachDocAsFile__c && job.DOX__Operation__c != 'getFields'}"></apex:outputField>
				<apex:pageBlockSectionItem rendered="{! !job.attachDocAsFile__c || job.Operation__c == 'getFields'}" ></apex:pageBlockSectionItem>
				
                <apex:pageBlockSectionItem id="emailStatus" helptext="Email Status" rendered="{!job.DOX__Operation__c != 'getFields'}">
					<apex:outputLabel value="Email Status" />
					<apex:outputPanel layout="block" style="overflow: scroll !important; height: 200px !important;" >
						<apex:outputField value="{!job.DOX__emailStatus__c}" ></apex:outputField> <!-- Added under RSTK-7182 -->
					</apex:outputPanel>
				</apex:pageBlockSectionItem>
				<apex:pageBlockSectionItem id="linkSection" helptext="Links for generated Document" rendered="{!job.DOX__Status__c=='Completed' && job.DOX__Operation__c != 'getFields'}">
					<apex:outputLabel value="Document Links" />
					<apex:outputPanel layout="block" style="overflow: scroll !important; height: 200px !important;" >
						<apex:pageBlockTable value="{!docInfoList}" var="a">
			                <apex:column headerValue="Link">
			                   <apex:outputlink target="_blank" value="/{!a.docID}">{!a.docTitle}</apex:outputlink>
			                </apex:column>
			            </apex:pageBlockTable>
					</apex:outputPanel>
				</apex:pageBlockSectionItem>
				 
				 
				
            </apex:pageBlockSection>
            <!-- <apex:pageBlockTable value="{!tasks}" var="task">
                <apex:column value="{!task.Subject}"></apex:column>
                <apex:column value="{!task.description}"></apex:column>
                <apex:column value="{!task.Status}"></apex:column>
            </apex:pageBlockTable> -->
            <apex:pageBlockTable value="{!tasks}" var="task" style="table-layout:fixed">
                <apex:column value="{!task.Subject}"></apex:column>
                <apex:column headerValue="Description" style="overflow:auto;white-space:pre">
                	<apex:outputText escape="false"  value="{!task.description}"/>
                </apex:column>
                <apex:column value="{!task.Status}"></apex:column>
            </apex:pageBlockTable>
            <apex:iframe src="/servlet/servlet.FileDownload?file={!job.DOX__Attachment_Id__c}" scrolling="true" id="docViewer"
                         rendered="{!AND(job.DOX__Status__c=='Completed',job.DOX__Attachment_Id__c != null,!job.DOX__attachDocAsFile__c )}"/>
            <apex:iframe src="/sfc/servlet.shepherd/version/download/{!job.DOX__Attachment_Id__c}?operationContext=S1" scrolling="true" id="docViewer1"
                         rendered="{!AND(job.DOX__Status__c=='Completed',job.DOX__Attachment_Id__c != null,job.DOX__attachDocAsFile__c )}"/>             
        </apex:pageBlock>

        <apex:actionPoller action="{!monitorStatus1}" reRender="formId" interval="5"
                           enabled="{!job.DOX__Status__c =='Not Started' || job.DOX__Status__c =='In Progress'}">
        </apex:actionPoller>
         
        <apex:actionPoller action="{!generateLinks}" reRender="docResult" interval="5"
                           enabled="{!AND(!linksGenerated,job.DOX__Status__c == 'Completed',job.DOX__Operation__c != 'getFields')}">  
        </apex:actionPoller>
    </apex:form>
</apex:page>